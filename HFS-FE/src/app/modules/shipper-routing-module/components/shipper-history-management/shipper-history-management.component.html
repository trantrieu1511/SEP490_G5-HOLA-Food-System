<div class="grid table-demo">
    <div class="col-12">
        <div class="card">
            <h5>{{'shipperhistoryScreen.allOrderhistory' | translate}}</h5>
            
            <p-calendar
            [(ngModel)]="rangeDates"
            selectionMode="range"
            [readonlyInput]="false"
            [maxDate]="currentDate"
            (onClose)="onCloseCalendar($event)"
            ></p-calendar>

            <p-table styleClass="p-datatable-orders" [value]="lstOrderHistory" 
                dataKey="name" [tableStyle]="{ 'min-width': '60rem' }" [rows]="10"
                [paginator]="true" [filterDelay]="0" [rowsPerPageOptions]="[5,10,25,50]"
                responsiveLayout="scroll"
                [loading]="loading"
                currentPageReportTemplate="Total {totalRecords} order on this status"
                [showCurrentPageReport]="showCurrentPageReport"
                >
                    <ng-template pTemplate="header">
                        <tr>
                            
                            <th  pSortableColumn="orderId">{{'shipperhistoryScreen.id' | translate}} <p-sortIcon field="orderId"></p-sortIcon></th>
                            <th  pSortableColumn="date">{{'shipperhistoryScreen.orderDate' | translate}} <p-sortIcon field="date"></p-sortIcon></th>
                            <th  pSortableColumn="date">{{'shipperhistoryScreen.shipDate' | translate}} <p-sortIcon field="date"></p-sortIcon></th>
                            <th pSortableColumn="price">{{'shipperhistoryScreen.price' | translate}} <p-sortIcon field="price"></p-sortIcon></th> 
                            <th pSortableColumn="address">{{'shipperhistoryScreen.address' | translate}} <p-sortIcon field="shipAddress"></p-sortIcon></th> 
                            <th pSortableColumn="phone">{{'shipperhistoryScreen.phoneNumber' | translate}} <p-sortIcon field="phoneNumber"></p-sortIcon></th> 
                            <th pSortableColumn="paymentMethod">{{'shipperhistoryScreen.paymentMethod' | translate}} <p-sortIcon field="paymentMethod"></p-sortIcon></th> 
                            <th pSortableColumn="status">{{'shipperhistoryScreen.status' | translate}} <p-sortIcon field="status"></p-sortIcon></th>                            
                            <th style="text-align: center" >{{'shipperhistoryScreen.action' | translate}}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-order let-expanded="expanded">
                        <tr>
                            
                            <td>{{order.orderId}}</td>
                            <td>{{order.orderDate | date:'dd/MM/yyyy hh:mm a'}}</td>
                            <td>{{order.shippedDate | date:'dd/MM/yyyy hh:mm a'}}</td>
                            <td>{{order.total | currency : "VND"}}</td>
                            <td>{{order.shipAddress}}</td>
                            <td>{{order.customerPhone}}</td>
                            <td *ngIf="order.paymentMethod == '0'">COD</td>
                            <td *ngIf="order.paymentMethod == '1'">WALLET</td>
                            <td>{{order.status}}</td>
                            <ng-container >
                                <td style="text-align: center">
                                    <div class="flex justify-content-center flex-wrap" style="gap: 0.5rem">
                                        <div class="flex align-items-center justify-content-center">
                                            <button pButton pRipple
                                            (click)="Detail(order.orderId)"
                                                    class="p-button-rounded p-mr-2 p-button-outlined">Detail
                                                </button>
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
                           
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="emptymessage">
                        <tr>
                            <td colspan="8">There are no order on this status yet.</td>
                        </tr>
                    </ng-template>
            </p-table>
        </div>
    </div>
</div>
<p-dialog [header]="headerDialog" [(visible)]="displayDialogConfirm"
          [breakpoints]="{'960px': '75vw'}"
          [style]="{width: '50vw'}"
          [draggable]="false" [resizable]="false" [maximizable]="true" >
    <div class="grid p-fluid">
        <div class="col-12 md:col-12">
            <div class="card">
                <p-divider align="left">
                    <div class="p-d-inline-flex p-ai-center">
                        <b>{{'shipperhistoryScreen.detail' | translate}}</b>
                    </div>
                </p-divider>
                <p-table [tableStyle]="{ 'min-width': '50rem' }"
                    [value]="orderDetails"
                >
                    <ng-template  pTemplate="header" >
                        <tr>
                            <th>{{'shipperhistoryScreen.foodId' | translate}}</th>
                            <th>{{'shipperhistoryScreen.image' | translate}}</th>
                            <th>{{'shipperhistoryScreen.foodName' | translate}}</th>
                            <th>{{'shipperhistoryScreen.unitPrice' | translate}}</th>
                            <th>{{'shipperhistoryScreen.quantity' | translate}}</th>
                        </tr>
                    </ng-template>
                    <ng-template pTemplate="body" let-orderDetail>
                        <tr>
                            <td>{{orderDetail.foodId}}</td>
                            <td><p-image src="data:image/gif;base64,{{orderDetail.imageBase64.imageBase64}}" [preview]="true"
                                [alt]="orderDetail.imageBase64.name" class="dialogimages_image w-10rem shadow-2"
                                ></p-image></td>                           
                            <td>{{orderDetail.foodName}}</td>
                            <td>{{orderDetail.unitPrice | currency : "VND"}}</td>
                            <td>{{orderDetail.quantity}}</td>
                        </tr>
                    </ng-template>
                </p-table>
                <!-- <p style="text-align: right;">Total: </p> -->
                <p-dataView #dv [value]="orderProgresses">
                    <ng-template let-progress pTemplate="listItem">
                        <div class="col-12">
                            <div class="flex flex-column xl:flex-row xl:align-items-start p-4 gap-4">
                                <div class="flex flex-column sm:flex-row justify-content-between align-items-center xl:align-items-start flex-1 gap-4">
                                    <div class="flex flex-column align-items-center sm:align-items-start gap-3">
                                        <div class="text-base font-semibold">{{ progress.status }}</div>
                                        <div class="flex align-items-center ml-5">
                                            <span class="flex align-items-center">
                                                <span class="font-normal">Time: {{ progress.createDate }}</span>
                                            </span>
                                        </div>
                                        <div *ngIf="progress.note" class="font-medium text-sm ml-5">*Note: {{ progress.note }}</div>
                                    </div>
                                    <div *ngIf="progress.imageBase64" class="flex sm:flex-column align-items-center sm:align-items-end gap-3 sm:gap-2">
                                      <p-image src="data:image/gif;base64,{{progress.imageBase64.imageBase64}}" [preview]="true"
                                        [alt]="progress.note" class="dialogimages_image w-10rem shadow-2"
                                        ></p-image>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </ng-template>
                </p-dataView>
                
            </div>
        </div>
    </div>
</p-dialog>
